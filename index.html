<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/blood.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<style>
		.ggImage {
			border: none !important;
			background: none !important;
			box-shadow: none !important;
		}

		.small-logo {
			width: 50% !important;
		}

		.ggCode {
			box-shadow: none !important;
			margin-top: -10px;
		}

		.ggCode code{
			max-height: none !important;
		}
	</style>

	<!-- Printing and PDF exports -->
	<script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
</head>
<body>
<div class="reveal">
	<div class="slides">
		<section>
			<section><h1>Welcome!</h1></section>
			<section>
				<h2 class="fragment">Patrick McGill</h2>
				<h2 class="fragment">Adam Davis</h2>
				<p class="fragment">
					<img class="ggImage small-logo" data-src="images/greenlight-guru-logo.svg"/>
				</p>
				<!-- Sponsors? -->
			</section>
			<section>
				<h3>What are we doing here?</h3>
				<p class="fragment">
					<img class="ggImage" data-src="images/spongebob-list.gif"/>
				</p>
			</section>
			<section>
				<img class="ggImage" data-src="images/apollo+graphql-1.png"/>
			</section>
		</section>
		<section>
			<section><h2>The Problem</h2></section>
			<section>
				<h3>REST at scale</h3>
				<p class="fragment">Lots of data points</p>
				<p class="fragment">More importantly, lots of edges</p>
				<p class="fragment">
					<img class="ggImage" style="width: 45%;" data-src="images/graph-ours-2.svg"/>
				</p>
			</section>
			<section>
				<img class="ggImage" data-src="images/filing-cabinet.jpg" />
			</section>
			<section>
				<h3>Enter Ember Data</h3>
				<img class="ggImage" data-src="images/ember-data-logo.png"/>
			</section>
			<section>
				<h3>Pros</h3>
				<ul>
					<li>Caching</li>
					<li>Querying</li>
					<li>Types... kind of</li>
				</ul>
			</section>
			<section>
				<h3>Cons</h3>
				<ul>
					<li>Network traffic</li>
					<li>Needs to know about models up front</li>
					<li>Greedy!</li>
				</ul>
			</section>
			<section>
				<h3>We can do better...</h3>
				<p class="fragment">
					<img class="ggImage" data-src="images/yes-you-can.webp"/>
				</p>
			</section>
		</section>
		<section>
			<section><h2>Theoretical Solution</h2></section>
			<section>
				<h3 class="fragment fade-in" data-fragment-index="0">GraphQL</h3>
				<div style="position:relative;">
					<p class="fragment fade-out" data-fragment-index="0">
						<img class="ggImage small-logo" data-src="images/graph-ours-2.svg"/>
					</p>
					<p class="fragment fade-in" style="position:absolute;top:-18px;" data-fragment-index="0">
						<img class="ggImage small-logo" data-src="images/graphql-logo.png"/>
					</p>
				</div>
			</section>
			<section>
				<h4>
					A query language for your API
				</h4>
				<pre class="ggCode">
					<code data-trim >
						type Person {
						  name: String
						  email: String
						  phoneNumber: String
						  age: Int
						  articles: [Article]
						}

						type Article {
						  title: String
						  text: String
						  author: Person
						  comments: [Post]
						}

						type Post {
						  text: String
						  date: Long
						  author: Person
						  article: Article
						}
					</code>
				</pre>
			</section>
			<section>
				<h4>Example Query</h4>
				<pre class="ggCode">
					<code data-trim>
					  query {
					    article(id: "1234") {
					      text
					      author {
					        name
					      }
					      comments {
					        text
					        date
					        author {
					          name
					        }
					      }
					    }
					  }
					</code>
				</pre>
			</section>
			<section>
				<h4>Example Response</h4>
					<pre class="ggCode">
						<code data-trim>
						  {
						    "data": {
						      "article": {
						        "text": "How to adopt GraphQL and Apollo",
						        "author": {
						          "name": "Patrick McGill"
						        },
						        "comments": [
						          {
						            "text": "Cool article",
						            "date": 111111111,
						            "author": {
						              "name": "Adam Davis"
						            }
						          },
						          ...
						        ]
						      }
						    }
						  }
						</code>
					</pre>
			</section>
			<section>
				<h3>graphql-java</h3>
				<img class="ggImage" data-src="images/graphql-java-logo.png"/>
				<ul class="fragment" data-fragment-index="0">
					<li>Based on JavaScript reference implementation</li>
					<li>Sensible defaults, highly customizable</li>
				</ul>
			</section>
			<section>
				<h4>Code-first schema generation</h4>
				<pre class="ggCode">
					<code data-trim class="java">
					GraphQLObjectType personType = newObject()
					  .name("Person")
					  .field(newFieldDefinition()
					    .name("name")
					    .type(GraphQLString))
					  .field(newFieldDefinition()
					    .name("email")
					    .type(GraphQLString))
					  .field(newFieldDefinition()
					    .name("phoneNumber")
					    .type(GraphQLString))
					  .field(newFieldDefinition()
					    .name("age")
					    .type(GraphQLInt))
					  .field(newFieldDefinition()
					    .name("articles")
					    .type(new GraphQLList(articleType)
					    .dataFetcher(environment ->
					      loadArticles(environment))
					  .build();
					</code>
				</pre>
			</section>
			<section>
				<img class="ggImage" data-src="images/apollo-white.svg" />
			</section>
				<section>
					<h4>A fully-featured, production ready GraphQL client</h4>
					<p class="fragment">Declaratively bind data to your view layer</p>
					<p class="fragment">Queries, caching, mutations, optimistic UI, subscriptions, pagination, server-side rendering, prefetching, and more.</p>
				</section>
				<section>
					<h4>Simple Setup (Ember CLI)</h4>
					<p>ember-apollo-client</p>
					<pre class="ggCode">
						<code data-trim class="javascript">
						// config/environment.js

						let ENV = {
						  ...
						  apollo: {
						    apiURL: 'https://test.example/graphql',
						    // this abstracts apollo configuration behind the scenes.
						    // more complex configuration is doable by overriding methods
						    // on the provided service.
						  },
						  ...
						}
						</code>
					</pre>
				</section>
				<section>
					<h4 style="margin-top: -30px !important;">Example Usage</h4>
					<pre class="ggCode">
						<code data-trim class="javascript" style="margin-top: -30px !important;">
					    import Route from "@ember/routing/route";
					    import RouteQueryManager from "ember-apollo-client/mixins/route-query-manager";
					    import gql from 'graphql-tag';
						
					    export default Route.extend(RouteQueryManager, {
					      model(params) {
					        let variables = { id: params.id };
					        return this.apollo.watchQuery({
					          gql`
					            query getPersonAndArticles($id: ID!) {
					              person(personId: $id) {
					                id
					                name
					                articles {
					                  id
					                  title
					                }
					              }
					            }
					          `,
					          variables
					        });
					      }
					    });
						</code>
					</pre>
				</section>
		</section>
		<section>
			<section><h2>Implementation</h2></section>
			<section data-background-image="images/mountains.jpg">
				<h3 >Where to begin?</h3>
			</section>
			<section>
				<h3>Rewrite from scratch?</h3>
				<p class="fragment">
					Not happening
				</p>
				<p class="fragment">
					<img style="width: 70%" data-src="images/build-in-flight.jpg" />
				</p>
			</section>
			<section>
				<h3>Incremental Adoption</h3>
				<p class="fragment">
					You guessed it!
					<!-- TODO image? -->
				</p>
			</section>
			<section>
				<h3>First things first</h3>
				<p class="fragment" data-fragment-index="0">Back-end support</p>
				<img class="ggImage fragment" data-fragment-index="0" data-src="images/wheelchair-dog.jpg" />
			</section>
			<section>
				<h3>Incremental Approach</h3>
				<ul>
					<li>Disconnected from ORM</li>
					<li>Cherry-pick supported resources as needed</li>
					<li>Mutations - single source of truth for business logic</li>
				</ul>
				<img class="ggImage fragment" style="width: 45%;" data-src="images/mutations-redirect.svg" />
			</section>
			<section>
				<h3>Front End Challenges</h3>
			</section>
			<section>
				<h4>The elephant in the room... </h4>
				<img class="fragment ggImage" data-src="images/ember-data-logo.png"/>
			</section>
			<section>
				<h4>How do we keep both data clients happy?</h4>
				<p class="fragment">Keep their caches up to date</p>
			</section>
			<section>
				<h4>Apollo => Ember-Data</h4>
				<pre class="ggCode">
					<code data-trim class="javascript">
					...
					updatePerson(newPerson) {
					  this.apollo.mutate({
					    mutation,
					    variables: { newPerson }
					  },
					  // update: developer facing API for making
					  // fine-grained manual updates to Apollo's cache
					  update(proxy, { data }) {
					    // we can opportunistically update ember-data
					    // by calling this.store.pushPayload here
					  })
					},
					...
					</code>
				</pre>
			</section>
			<section>
				<h4>Ember-Data => Apollo</h4>
				<pre class="ggCode">
					<code data-trim class="javascript">
					...
					updatePlace: async function(placeId, newPlaceTitle) {
					  const place = await this.store.find('place', placeId);
					  place.set('title', newPlaceTitle);
					  await place.save();
					  
					  // inform apollo of new data by writing
					  // writing directly to the cache
					  this.apollo.writeFragment({
					    id: placeId,
					    fragment: gql`
					      fragment newPlaceTitle on Place {
					        title
					      }
					    `,
					    data: {
					      title: newPlaceTitle
					    }
					  });
					},
					...
					</code>
				</pre>
			</section>
			<section>
				<h3>Gotchas</h3>
				<p>
					The developer's relationship with the cache is substantially different than with Ember-data
				</p>
				<p class="fragment">
					Analogous to driving a manual vs an automatic
				</p>
				<img class="fragment ggImage" src="images/what-gear-is-it.jpg" />
			</section>
			<section>
				<h3>Gotchas (cont.)</h3>
				<p>Required us to rethink authorization</p>
				<p>Separate micro-service - lots of network traffic!</p>
			</section>
			<section>
					<h3>Benefits</h3>
					<ul>
						<li>Encourages component-first development through use of co-location</li>
						<li>Allows us to think of performance at the field level instead of model level</li>
					</ul>
				</section>
		</section>
		<section>
			<section><h2>Where do we go from here?</h2></section>
			<section>
				<h3>Good-bye, Ember-Data<span class="fragment"> (eventually)</span></h3>
				<!-- TODO "yay" image -->
			</section>
			<section>
				<h3>Single source of truth for the front-end</h3>
				<p>
					Multiple back-end data sources, funneled through a single schema
				</p>
				<ul>
					<li>Business logic</li>
					<li>elasticSearch</li>
					<li>auth services</li>
					<li>integrations</li>
				</ul>
			</section>
			<section>
				<h3>Phase out standard REST resources</h3>
				<p>
					No more resource re-routing
				</p>
				<img class="ggImage fragment" data-src="images/mutations-noredirect.svg" />
			</section>
			<section>
				<h3>Subscriptions</h3>
				<p>Low-latency updates via real-time transfer protocol (e.g. websockets)</p>
				<pre class="fragment ggCode">
					<code data-trim>
						  subscription onPostAdded($articleId: ID!) {
						    postAdded(articleId: $articleId) {
						      id
						      msg
						    }
						  }	
					</code>
				</pre>
			</section>
			<section>
				<h3>Fine-grained Server-side Analytics</h3>
				<ul>
					<li>Execution time</li>
					<li>Usage Statistics</li>
					<li>Error Reporting</li>
				</ul>
				<p>can all be accomplished at the field level</p>
			</section>
			<section>
				<h3>Apollo Engine</h3>
				<p>Self hosted proxy that aggregates data and sends to Apollo's cloud analytics service</p>
				<img class="ggImage fragment" data-src="images/engine-architecture.svg" />
			</section>
		
		</section>
		<section>
			<section>
				<h1>Thanks!</h1>
			</section>
			<section>
				<h2>We're hiring</h2>
				<h3>
					<a href="http://www.greenlight.guru/careers">greenlight.guru/careers</a>
				</h3>
			</section>
		</section>
	</div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        dependencies: [
            { src: 'plugin/markdown/marked.js' },
            { src: 'plugin/markdown/markdown.js' },
            { src: 'plugin/notes/notes.js', async: true },
            { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
    });
</script>
</body>
</html>
